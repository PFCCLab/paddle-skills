name: Check PR Title

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  check-pr-title:
    name: Validate PR title format
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    steps:
      - name: Check PR title
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          echo "PR title: $PR_TITLE"
          # Match the format defined in CONTRIBUTING.md:
          # <emoji> <type>(<scope>): <subject>  or  <emoji> <type>: <subject>
          # Allowed types: add, update, fix, docs, chore
          if echo "$PR_TITLE" | grep -Pq '^(âœ¨ add|â¬†ï¸ update|ğŸ› fix|ğŸ“ docs|ğŸ”§ chore)(\([^)]+\))?: .+'; then
            echo "âœ… PR title format is valid."
          else
            echo "âŒ PR title does not match the required format."
            echo ""
            echo "Expected format: <emoji> <type>(<scope>): <subject>"
            echo ""
            echo "Allowed types:"
            echo "  âœ¨ add(<skill-name>): <subject>"
            echo "  â¬†ï¸ update(<skill-name>): <subject>"
            echo "  ğŸ› fix(<skill-name>): <subject>"
            echo "  ğŸ“ docs: <subject>"
            echo "  ğŸ”§ chore: <subject>"
            echo ""
            echo "Examples:"
            echo "  âœ¨ add(paddle-trace): initial version"
            echo "  â¬†ï¸ update(paddle-pull-request): support multi template"
            echo "  ğŸ› fix(paddle-debug): handle empty log path"
            echo "  ğŸ“ docs: update contributing.md"
            echo "  ğŸ”§ chore: upgrade actions dependencies"
            exit 1
          fi
