name: Check PR Title

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  check-pr-title:
    name: Validate PR title format
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    steps:
      - name: Check PR title
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          echo "PR title: $PR_TITLE"
          # Match the format defined in CONTRIBUTING.md:
          # âœ¨ add / â¬†ï¸ update / ğŸ› fix require a (<skill-name>) scope â€” for skill changes only
          # ğŸ“ docs / ğŸ”§ chore take an optional scope â€” for docs, CI, or other infra changes
          if echo "$PR_TITLE" | grep -Pq '^(âœ¨ add|â¬†ï¸ update|ğŸ› fix)\([^)]+\): .+' || \
             echo "$PR_TITLE" | grep -Pq '^(ğŸ“ docs|ğŸ”§ chore)(\([^)]+\))?: .+'; then
            echo "âœ… PR title format is valid."
          else
            echo "âŒ PR title does not match the required format."
            echo ""
            echo "Expected format: <emoji> <type>(<scope>): <subject>"
            echo ""
            echo "Allowed types:"
            echo "  âœ¨ add(<skill-name>): <subject>   # adding a new skill"
            echo "  â¬†ï¸ update(<skill-name>): <subject> # updating an existing skill"
            echo "  ğŸ› fix(<skill-name>): <subject>   # fixing a skill issue"
            echo "  ğŸ“ docs: <subject>                 # documentation changes"
            echo "  ğŸ”§ chore: <subject>                # CI, infra, or other misc changes"
            echo ""
            echo "Note: âœ¨ add / â¬†ï¸ update / ğŸ› fix are for skill changes and require a skill-name scope."
            echo "      For CI or infrastructure changes, use ğŸ”§ chore instead."
            echo ""
            echo "Examples:"
            echo "  âœ¨ add(paddle-trace): initial version"
            echo "  â¬†ï¸ update(paddle-pull-request): support multi template"
            echo "  ğŸ› fix(paddle-debug): handle empty log path"
            echo "  ğŸ“ docs: update contributing.md"
            echo "  ğŸ”§ chore: add CI workflow for PR title validation"
            exit 1
          fi
